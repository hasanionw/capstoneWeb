

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Inventory - California Fitness Gym</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
  <!-- Bootstrap core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Design Bootstrap -->
  <link href="css/mdb.min.css" rel="stylesheet">
  <!-- Your custom styles (optional) -->
  <link href="css/style.min.css" rel="stylesheet">
  <link rel="icon" href="images/gym_logo.png">
  <link href="css/theme-colors.css" rel="stylesheet">

    

<style>
  input[type=text], input[type=date] {
  
  height: 45px;
} 

.train select{
  height: 45px;
  
}

.bot button{
  background-color:#DF3A01;
  color:white;
} 
.bot{
  height:70px;
  background-color:honeydew;
}


  .card-bodyzz {
      max-height: 325px;
      overflow-y: auto;
    }
    .flexHeader {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .flex {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    table > thead > tr > th {
      font-weight: bold;
      text-transform: uppercase;
      
    }
    .inventory-cards {
          width: 30%;
        }

        #inventory-cont {
          display: flex;
          flex-wrap: wrap;
          justify-content: flex-start;
        }

        #main-div {
          display: flex;
          flex-direction: column;
          justify-content: center;
        }

        .card-img-top {
          width: 100% !important;
          height: 10vw !important;
          object-fit: cover !important;
        }
        body::-webkit-scrollbar {
        width: 0 !important;
      }
</style>
</head>

<body class="grey lighten-3" >

  <!--Main Navigation-->
  <header>

    <nav class="navbar fixed-top navbar-light bg-darkgrey" >
      <div class="container-fluid" >
        <h6 style="margin-bottom: 0 !important;">
          Welcome, <b><span id="username" class='text-orange font-weight-bold'></span></b>!
        </h6>
        <div class="logout">
          <button id="logoutBtn" type="button" class="btn btn-sm btn-danger">LOGOUT</button>
        </div>
      </div>
    </nav>
   

    <!-- Sidebar -->
     <div class="sidebar-fixed position-fixed" style="background-color:#DF3A01;" >
      <br>
     
        <center><img src="logo.png" class="img-fluid" alt="" style="width: 200px; height: 180px;"></center>

        <br>

        <div class="list-group list-group-flush" >
          <a href="dashboard.html" class="list-group-item list-group-item-action waves-effect sidebar-items">
            <i class="fas fa-chart-pie mr-3"></i>Dashboard
          </a>
          <a href="members.html" class="list-group-item list-group-item-action waves-effect sidebar-items">
            <i class="fas fa-user mr-3"></i>Members</a>
          <a href="trainers.html" class="list-group-item list-group-item-action waves-effect sidebar-items">
            <i class="fas fa-user-shield mr-3"></i>Trainers
          </a>
          <a href="inventory.html" class="list-group-item list-group-item-action waves-effect sidebar-item-active">
            <i class="fas fa-dumbbell  mr-3"></i>Inventory</a>
          <a href="promos.html" class="list-group-item list-group-item-action waves-effect sidebar-items">
            <i class="fas fa-percent mr-3"></i>Promos
          </a>
          <a href="paymentlog.html" class="list-group-item list-group-item-action waves-effect sidebar-items">
            <i class="fas fa-money-bill-alt mr-3"></i>Payment Log
          </a>
          <a href="reports.html" class="list-group-item list-group-item-action waves-effect sidebar-items">
            <i class="fas fa-flag-checkered mr-3"></i>Reports
          </a>
          <a href="logtrail.html" class="list-group-item list-group-item-action waves-effect sidebar-items">
            <i class="fas fa-history mr-3"></i>Logtrail
          </a>
        </div>  

    </div>
    <!-- Sidebar -->

  </header>
  <!--Main Navigation-->

   <!--Main layout-->
   <main class="pt-5 mx-lg-5" >
    <div class="container-fluid mt-5" id="main-div">
      <!-- Heading -->
      <div class="card mb-4 wow fadeIn">
        <!--Card content-->
        <div class="card-body d-sm-flex justify-content-between">
          <h4 class="mb-1 mb-sm-1 pt-1">
            <a data-toggle="modal" data-target="#add"><i style="color:#DF3A01; font-size: 25px;" data-toggle="tooltip" data-placement="top" title="Add Item"  class="fas fa-plus mr-4"></i></a>
            Inventory
          </h4>
          <div class="btn-group" role="group" aria-label="Basic example">
            <button type="button" id="sort-weights" class="btn btn-sm btn-outline-orange">WEIGHTS</button>
            <button type="button" id="sort-both" class="btn btn-sm btn-orange">Both</button>
            <button type="button" id="sort-machines" class="btn btn-sm btn-outline-orange">MACHINES</button>
          </div>
          <form class="d-flex justify-content-center">
            <input type="search" placeholder="Search inventory name" aria-label="Search" class="form-control">
            <button class="btn btn-orange btn-sm my-0 p" type="submit">
              <i class="fas fa-search" ></i>
            </button>
          </form>
        </div>
      </div>
      <div id="inventory-cont">

      </div>
    </div>
  </main>

      
      <div class="modal fade" id="displayallrecords">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header"style="background-color:#DF3A01;">
              <h3 class="modal-title" style="color:white;">information <span id="viewfname-span"></span></h3>
             
              <button type='button' class='close'id='close-view-modal' data-dismiss='modal'>&times;</button>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <div class="form-row">
                  <div class="col-sm-6">
                    <label>Inventory ID</label>
                    <input type="text" class="form-control" id="view-id" disabled>
                  </div>
                  
                   <div class="col-sm-6">
                    <label>Name</label>
                    <input type="text" class="form-control" id="view-name" disabled>
                  </div>
                  <div class="col-sm-6">
                    <label>Category</label>
                    <input type="text" class="form-control" id="view-category" disabled>
                  </div>
                  <div class="col-sm-6">
                    <label>Total Quantity </label>
                    <input type="text" class="form-control" id="view-quantity" disabled>
                  </div>
                  <div class="col-sm-6">
                    <label>No. of Working item</label>
                    <input type="text" class="form-control" id="view-working" disabled>
                  </div>
                  <div class="col-sm-6">
                    <label>No. of Damage item</label>
                    <input type="text" class="form-control" id="view-damage" disabled>
                  </div>
                  <div class="col-sm-6">
                    <label>Description</label>
                    <textarea id="view-description" style="height: 150px; width: 465px;" class="form-control" disabled></textarea>
                  </div>
                 
                 
                </div>
                </div>
               
              </div>
            
             
            </div>
            
          </div>
        </div>

<div class="modal fade" id="update">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"style="background-color:#DF3A01;">
        <h3 class="modal-title" style="color:white;">Update <span id="fname-span"></span></h3>
       
        <button type='button' class='close' id='close-updateModal' data-dismiss='modal'>&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <div class="form-row">
            <div class="col-sm-6">
              <label>Name</label>
              <input type="text" class="form-control" id="updatename" disabled>
            </div>
            <div class="col-sm-6">
              <label>Quantity</label>
              <input type="text" class="form-control" id="updatequantity" >
            </div>
        
            
            <div class="col-sm-6">
              <label>Category</label>
              <select id="updatecategory" class="form-control">
                <option value="Free Weights" selected>Free Weights</option>
                <option value="Cardio Machines">Cardio Machines</option>
              </select>
            </div>

            <div class="col-sm-6"></div>

            <div class="col-sm-6">
              <label></label>
  
              <h5 style="text-align: center;">Number of item</h5>
              <div class="form-row">
                <div class="col-sm-5">
                  <label>Damage</label>
                  <input type="text" placeholder="number" class="form-control" id="updatedamage">
                </div>
                <div class="col-sm-4">
                  <label>Working</label>
                  <input type="text" class="form-control" id="updateworking" disabled>
                </div>
                <div class="col-sm-2">
                  <label></label>
                  <button class="btn btn-success btn-sm" id="enterCalc">Enter</button>
                </div>
              </div>
            </div>
            
            
          </div>
        </div>
      
       
      </div>
      <div class="modal-footer"  style="height: 70px;">
        <button class="btn" style="background-color:#DF3A01; color:white;" id="updateBtn">Update</button>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="add" >
  <div class="modal-dialog">
    <div class="modal-content" >
      <div class="modal-header" style="background-color:#DF3A01;">
        <h3 class="modal-title" style="color:white;">Add new Item </h3>  
     
        <button type='button' class='close' id='close-modal' data-dismiss='modal'>&times;</button>
      </div>  
      <div class="modal-body">
        <div class="row d-flex mt-1 mb-3" style="flex-direction: row; position: relative;left: 70px;">
          <div id="profilepic" style="border-radius: 50px; height: 100px; width: 100px; overflow: hidden; background-position: 50% 50%; background-size: cover;  text-align: center;">
            <img src="blank.png" id="output" alt="" style="height: 100%; width: 100%; object-fit: cover;">
            
          </div>
          <p><input type="file"  accept="image/*" name="image" id="file"  onchange="loadFile(event)" style="display: none;"></p>
          <p><label for="file" style="cursor: pointer;"><i  data-toggle="tooltip" data-placement="top" title="Add item picture" style="font-size: 35px; color:teal;" class="fas fa-plus-circle"></i></label></p>

          <div class="col-sm-6" style="position: relative; left: 35px;">
            <label>Item name</label>
            <input type="text" id="name"  class="form-control" required="" placeholder="Item name">
          </div>

        </div>
        <div class="form-group">
          <div class="form-row">
            <div class="col-sm-6">
              <label>Quantity</label>
                <input type="text" id="quantity"  class="form-control" required="" placeholder="Quantity">
            </div>
            
          <div class="col-sm-6 train">
            <label>Category</label><br>
            <select id="category"  class="form-control" name="category"  required="" style="left:60px;">
              <option value="Free Weights" selected>Free Weights</option>
              <option value="Cardio Machines">Cardio Machines</option>
           </select>
          </div>
          <div class="col-sm-6 ">
            <label>Description</label><br>
             

              <textarea rows="5" class="form-control" 
              cols="100" class="form-control" id="description"
               required data-validation-required-message="Please enter description" 
               placeholder="Enter description" maxlength="999" style="height: 100px; width: 465px;"
               ></textarea>
        </div>
          </div>
        </div>
      </div>

      <div class="modal-footer bot">
        <button type="submit"  id="addBtn"  class="btn" >ADD ITEM</button>
     

      </div>
    </div>
  </div>
</div>

              </div>
              <!-- /.First row-->

            </div>

          </div>
          <!--/.Card-->

        </div>
        <!--Grid column-->

      </div>
      <!--Grid row-->

    </div>


  

  <!-- SCRIPTS -->
  <!-- JQuery -->
  <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" src="js/popper.min.js"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="js/mdb.min.js"></script>
  <!-- Initializations -->

  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script> 
  <script src="jquery-3.4.1.min.js"></script>

   <!-- Firebase CDNs -->
   <script src="https://www.gstatic.com/firebasejs/7.8.0/firebase-app.js"></script>
   <script src="https://www.gstatic.com/firebasejs/7.8.0/firebase-auth.js"></script>
   <script src="https://www.gstatic.com/firebasejs/7.8.0/firebase-firestore.js"></script>
   <script src="https://www.gstatic.com/firebasejs/7.8.0/firebase-storage.js"></script>
   <!-- Local script -->
   <script src='js/init.js'></script>


   <script>

   
 
// creating a data 
    var button = document.getElementById('addBtn');

    button.addEventListener('click', function() {
      var name = document.getElementById('name').value;
      var category = document.getElementById('category').value;
      var quantity = document.getElementById('quantity').value;
     
      var description = document.getElementById('description').value;

// checking if there is a duplicate data
      var inventory = db.collection('inventory');
      var storage = inventory.where('name', '==', name);

      if(name === '') {
        alert('ERROR: Item name is required!');
      } else if(category === '') {
        alert('ERROR: Category is required!');
      } else if(quantity === '') {
        alert('ERROR: quantity is required!');
      
      }else if(description === '') {
        alert('ERROR: description  is required!');
      } else {

      storage.get().then(function(snapshot) {
        if(snapshot.docs.length > 0) {
          alert('Error: Inventory already exists!');
        } else {
          inventory.add({
            name: name,
            category: category,
            quantity: quantity,
            working: quantity,
            damage: "0",
            description: description
            
          }).then(function() {
            alert('Successfully added new Inventory!');
            window.location.reload();
          }).catch(function(error) {
            alert(error.message);
          });
        }
      });
      }
    });

     // para mo upload kag picture    
var loadFile = function(event) {
                  var image = document.getElementById('output');
                  image.src = URL.createObjectURL(event.target.files[0]);
              };

         

renderCard = ({id, data}) => {
        let InventoryCont = document.getElementById('inventory-cont');
        let card = document.createElement('div');
        card.classList.add('card', 'inventory-cards', 'mx-3', 'my-3');
        card.setAttribute('data-id', id)
        card.innerHTML = 
          `<img src="blank.png" class="card-img-top">
          <div class="card-body">
            <h3 class="card-title font-weight-bold text-orange">${data.name}</h3>
            <h6 class="card-subtitle text-muted font-weight-bold">${data.category}</h6>
            <p class="card-text mt-2">${data.description}</p>
          </div>
          <div class="card-footer">
            <button  onclick='viewInventory(this.parentNode.parentNode)'
         data-toggle='modal' data-target='#displayallrecords' class="btn btn-sm btn-orange">View details</btn>  
         <button  onclick='updatefunction(this.parentNode.parentNode)'
         data-toggle='modal' data-target='#update' style="float:right" class="btn btn-sm btn-orange">Update</btn>
          </div>
          
          `;

          InventoryCont.appendChild(card);
      }

    let sortWeights = document.getElementById('sort-weights');
    let sortBoth = document.getElementById('sort-both');
    let sortMachines = document.getElementById('sort-machines');
    let card = document.getElementById('inventory-cont');

    // Sorting by BOTH
    sortBoth.onclick = () => {
      card.innerHTML = '';
      sortBoth.classList.add('btn-orange');
      sortBoth.classList.remove('btn-outline-orange');
      sortMachines.classList.add('btn-outline-orange');
      sortMachines.classList.remove('btn-orange');
      sortWeights.classList.add('btn-outline-orange');
      sortWeights.classList.remove('btn-orange');

      db.collection('inventory').orderBy('name', 'asc').get().then((snapshot) => {
        snapshot.forEach((doc) => {
          renderCard({id: doc.id, data: doc.data()});
        });
      });
    }

    // Sorting by Weights
    sortWeights.onclick = () => {
      card.innerHTML = '';
      sortBoth.classList.add('btn-outline-orange');
      sortBoth.classList.remove('btn-orange');
      sortMachines.classList.add('btn-outline-orange');
      sortMachines.classList.remove('btn-orange');
      sortWeights.classList.add('btn-orange');
      sortWeights.classList.remove('btn-outline-orange');

      db.collection('inventory').where('category', '==', 'Free Weights').orderBy('name', 'asc').get().then((snapshot) => {
        snapshot.forEach((doc) => {
          renderCard({id: doc.id, data: doc.data()});
        });
      });
    }

      // Sorting by machines
      sortMachines.onclick = () => {
      card.innerHTML = '';
      sortBoth.classList.add('btn-outline-orange');
      sortBoth.classList.remove('btn-orange');
      sortMachines.classList.add('btn-orange');
      sortMachines.classList.remove('btn-outline-orange');
      sortWeights.classList.add('btn-outline-orange');
      sortWeights.classList.remove('btn-orange');

      db.collection('inventory').where('category', '==', 'Cardio Machines').orderBy('name', 'asc').get().then((snapshot) => {
        snapshot.forEach((doc) => {
          renderCard({id: doc.id, data: doc.data()});
        });
      });
    }


    // display data by name 
    db.collection('inventory').orderBy('name', 'asc').get().then(function(snapshot) {
      snapshot.forEach((doc) => {
       
        renderCard({id: doc.id, data: doc.data()});
      });
    });


    // ID show and hide in the table
    function showID(id) {
      let span = document.getElementById(`${id}-span`);
      let small = document.getElementById(`${id}-small`);

      if(span.classList.contains('hidden')) {
        small.innerHTML = ' <i style="font-size: 20px;" class="fas fa-eye-slash"></i>';
        span.textContent = id;
        span.classList.remove('hidden');
      } else {
        small.innerHTML = ' <i style="font-size: 20px;" class="fas fa-eye"></i>';
        span.classList.add('hidden');
        span.textContent = '';
      } 
    }


 
   // update function
   function updatefunction(tr) {
      let updatename = document.getElementById('updatename');
      let updatequantity = document.getElementById('updatequantity');
      let updateworking = document.getElementById('updateworking');
      let updatedamage = document.getElementById('updatedamage');
      let span = document.getElementById('fname-span');
      let dataId = tr.getAttribute('data-id');
    

      db.collection('inventory').doc(dataId).get().then(function(doc) {
        span.textContent = doc.data().name; // firstname na mo display sa update modal
        updatename.value = doc.data().name;
        updatequantity.value = doc.data().quantity;
        updateworking.value = doc.data().working;
        updatedamage.value = doc.data().damage;
       

      document.getElementById('updateBtn').addEventListener('click', () => {
          let quantity = document.getElementById('updatequantity').value;
          let category = document.getElementById('updatecategory').value;
          let working = document.getElementById('updateworking').value;
          let damage = document.getElementById('updatedamage').value;
          db.collection('inventory').doc(doc.id).update({
            quantity: quantity,
            category: category,
            working: working,
            damage: damage
              
          }).then(() => {
            alert('Successfully updated Inventory!');
            window.location.reload();
          }).catch((error) => {
            alert(`Error: ${error.message}`);
          });
        });
      });
    }
    


    auth.onAuthStateChanged(function(user) {
      let span = document.getElementById('username');

      if(user) {
        span.textContent = user.email;
      }
    })

// show all the inputed data in the modal
    function viewInventory(x) {
      let span = document.getElementById('viewfname-span');
      let dataid = x.getAttribute("data-id");
      let viewId = document.getElementById("view-id");
      let name = document.getElementById("view-name");
      let category = document.getElementById("view-category");
      let quantity = document.getElementById("view-quantity");
      let working = document.getElementById("view-working");
      let damage = document.getElementById("view-damage");
      let description = document.getElementById("view-description");
      
      
  
      db.collection("inventory").doc(dataid).get().then(function(doc) {
        span.textContent = doc.data().name; 
        viewId.value = dataid;
        name.value = doc.data().name;
        category.value = doc.data().category;
        quantity.value = doc.data().quantity;
        working.value = doc.data().working;
        damage.value = doc.data().damage;
        description.value = doc.data().description;
       
        
      });
    }

    // logout script
    document.getElementById("logoutBtn").addEventListener("click", function() {
      var x = confirm("Are you sure?");
      if(x === true){
        firebase.auth().signOut().then(function() {
          alert("Logout successful!");
          window.location.href = "index.html";
        }).catch(function() {
          alert("Failed to log out!");
        })
      }
    });
  
    // security, must login
    firebase.auth().onAuthStateChanged(function(user){
      if(user) {
        
      } else {
        window.location.href = "index.html";
      }
    })

    // tool tip sa plus button
    $(function () {
      $('[data-toggle="tooltip"]').tooltip();
    });




   
// mo calculate sha
    document.getElementById('enterCalc').addEventListener('click', () => {
      let damage = document.getElementById('updatedamage');
      let working = document.getElementById('updateworking');
      let quantity = document.getElementById('updatequantity');

      let x = parseInt(damage.value);
      let y = parseInt(quantity.value);

      working.value = y-x;
    });

    
  </script>
  
</body>

</html>
